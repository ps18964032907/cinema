<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>添加品牌</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
    <script src="jquery.min.js"></script>
    <style>
        body {
            background-color: #ffffff;
        }
    </style>
</head>
<body>
<form>
    <div class="layui-form layuimini-form">
        <div class="layui-form-item">
            <label class="layui-form-label required">电影名称</label>
            <div class="layui-input-block">
                <input type="text" name="movieName" lay-verify="required" lay-reqtext="用户名不能为空" placeholder="请输入用户名"
                       value=""
                       class="layui-input">
                <tip>填写影片的名称。</tip>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">类别</label>
            <div class="layui-input-block" id="movieTypes">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label ">上映时间</label>
            <div class="layui-input-block">
                <input name="movieReleaseTime" id="test1"
                       placeholder="请输入上映年份"
                       value=""
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">封面图片</label>
            <div class="layui-input-block">
                <input type="file" name="img" class="layui-input" onchange="show(this)">
            </div>
            <br>
            <div class="layui-input-block">
                <img src="" id="img" style="height: 140px;width: 100px;border: 1px solid red">
            </div>


        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">职业</label>
            <div class="layui-input-block">
                <input type="text" name="work" placeholder="请输入职业" value="" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">备注信息</label>
            <div class="layui-input-block">
                <textarea name="remark" class="layui-textarea" placeholder="请输入备注信息"></textarea>
            </div>
        </div>


        <div class="layui-form-item">
            <label class="layui-form-label">
                <button type="button" class="layui-btn" id="addCast0">增加导演</button>
                <button type="button" class="layui-btn">删除导演</button>
            </label>

            <div class="layui-input-block" id="cast0">
            </div>
        </div>


        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
            </div>
        </div>


    </div>

</form>
<script src="../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script>
    layui.use(['form'], function () {
        var form = layui.form,
            layer = layui.layer,
            $ = layui.$;


        $.get("/AllMovie/AllMovieType", function (data) {
            console.log(data);

            for (let i = 0; i < data.length; i++) {
                $("#movieTypes").append("<input type=\"checkbox\" name=\"movieTypes[]\" value=\"" + data[i].typeId + "\" title=\"" + data[i].typeName + "\">")
                form.render();
            }
        });

        let cast0s = "";
        let cast1s = "";


        //获取所有导演列表
        $.get("/Cast/getAllCast", function (data) {

            data = data.data;
            cast0s = "<select name = 'cast0[]'>";
            for (let i = 0; i < data.length; i++) {
                cast0s += "<option value='" + data[i].actorId + "'>" + data[i].actorName + "</option>"
            }
            cast0s += "</select>";
        });

        //获取所有演员列表
        $.get("/Cast/getAllCast", function (data) {
            data = data.data;
            cast1s = "<select name = 'cast1[]'>";
            for (let i = 0; i < data.length; i++) {
                cast1s += "<option value='" + data[i].actorId + "'>" + data[i].actorName + "</option>"
                cast1s += "<input type=\"text\" name=\"cast1Role[]\" placeholder=\"请输入职业\" value=\"\" class=\"layui-input\">\n"
            }
            cast1s += "</select>";
        });


        /*-----------------导演的添加----------------*/
        //因为动态添加的元素class属性是无效的，所以不能用$('.add').click(function(){});
        $('body').on('click', '#addCast0', function () {
            console.log(cast0s);
            $(cast0s).appendTo($('#cast0'));
            form.render();
        });


        //监听提交
        form.on('submit(saveBtn)', function (data) {
            var index = layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            }, function () {

                // 关闭弹出层
                layer.close(index);

                var iframeIndex = parent.layer.getFrameIndex(window.name);
                parent.layer.close(iframeIndex);

            });

            return false;
        });

    });
</script>

<script src="/static/build/layui.js"></script>
<script>
    layui.use('laydate', function () {
        var laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#test1' //指定元素
        });
    });
</script>


<!--//图片的回显-->
<script>
    function show(file) {
        var reader = new FileReader();	// 实例化一个FileReader对象，用于读取文件
        var img = document.getElementById('img'); 	// 获取要显示图片的标签

        //读取File对象的数据
        reader.onload = function (evt) {
            img.width = "80";
            img.height = "80";
            img.src = evt.target.result;

        }
        reader.readAsDataURL(file.files[0]);
    }
</script>
</body>
</html>